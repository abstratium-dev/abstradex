<div class="container">
  <div class="page-header">
    <h2>Contacts for Partner {{ getPartnerNumberAndName() || 'Loading...' }}</h2>
    <button class="btn-secondary" (click)="goBack()">‚Üê Back</button>
  </div>

  <div class="form-actions">
    <button class="btn-primary" (click)="toggleAddForm()">
      {{ showForm ? 'Cancel' : (editingContact ? 'Cancel Edit' : '+ Add Contact') }}
    </button>
  </div>

  <!-- Add/Edit Contact Form -->
  <div class="form-container" *ngIf="showForm">
    <h3>{{ editingContact ? 'Edit Contact' : 'Add New Contact' }}</h3>
    
    <div class="form-group">
      <label for="contactType">Contact Type *</label>
      <select id="contactType" [(ngModel)]="contactForm.contactType" required>
        <option *ngFor="let type of contactTypes" [value]="type">{{ type }}</option>
      </select>
    </div>

    <div class="form-group">
      <label for="contactValue">Contact Value *</label>
      <input 
        [type]="getInputType()" 
        id="contactValue" 
        name="contactValue"
        #contactValueInput="ngModel"
        [(ngModel)]="contactForm.contactValue" 
        [placeholder]="getPlaceholder()"
        [pattern]="getValidationPattern()"
        required
      />
      <div class="validation-error" *ngIf="contactValueInput.invalid && (contactValueInput.dirty || contactValueInput.touched)">
        <small *ngIf="contactValueInput.errors?.['required']">Contact value is required</small>
        <small *ngIf="contactValueInput.errors?.['pattern']">
          <span *ngIf="contactForm.contactType === 'EMAIL'">Please enter a valid email address</span>
          <span *ngIf="contactForm.contactType === 'PHONE' || contactForm.contactType === 'MOBILE' || contactForm.contactType === 'FAX'">Please enter a valid phone number (digits, +, -, spaces, parentheses)</span>
          <span *ngIf="contactForm.contactType === 'WEBSITE' || contactForm.contactType === 'LINKEDIN'">Please enter a valid URL starting with http:// or https://</span>
        </small>
      </div>
    </div>

    <div class="form-group">
      <label for="label">Label</label>
      <input 
        type="text" 
        id="label" 
        [(ngModel)]="contactForm.label" 
        placeholder="e.g., Work, Personal, Main Office"
      />
    </div>

    <div class="checkbox-group">
      <label>
        <input type="checkbox" [(ngModel)]="contactForm.isPrimary">
        Primary Contact
      </label>
    </div>

    <div class="checkbox-group">
      <label>
        <input type="checkbox" [(ngModel)]="contactForm.isVerified">
        Verified
      </label>
    </div>

    <div class="form-actions">
      <button class="btn-primary" (click)="onSubmit()">
        {{ editingContact ? 'Update Contact' : 'Add Contact' }}
      </button>
      <button class="btn-secondary" (click)="toggleAddForm()">Cancel</button>
    </div>
  </div>

  <!-- Loading State -->
  <div *ngIf="loading" class="loading"><p>Loading partner contacts...</p></div>

  <!-- Error State -->
  <div *ngIf="error" class="error-box">
    <p>{{ error }}</p>
    <button class="btn-primary" (click)="loadPartnerContacts()">Retry</button>
  </div>

  <!-- Partner Contacts List -->
  <div *ngIf="!loading && !error">
    <h3>Partner Contacts ({{ partnerContacts.length }})</h3>
    
    <div *ngIf="partnerContacts.length === 0" class="info-message">
      <p>No contacts assigned to this partner yet.</p>
      <p>Click "Add Contact" to create a new contact.</p>
    </div>

    <div class="contact-list">
      <div *ngFor="let contact of partnerContacts; let i = index" class="contact-item" (click)="closeContextMenu(i)">
        <div class="contact-info">
          <div class="contact-icon">{{ getContactTypeIcon(contact.contactType || '') }}</div>
          <div class="contact-text">
            <div class="contact-value">
              <a *ngIf="isContactClickable(contact)" 
                 [href]="getContactHref(contact)" 
                 [target]="contact.contactType === 'WEBSITE' || contact.contactType === 'LINKEDIN' ? '_blank' : ''"
                 [rel]="contact.contactType === 'WEBSITE' || contact.contactType === 'LINKEDIN' ? 'noopener noreferrer' : ''">
                {{ contact.contactValue }}
              </a>
              <span *ngIf="!isContactClickable(contact)">{{ contact.contactValue }}</span>
            </div>
            <div class="contact-meta">
              <span class="contact-type">{{ contact.contactType }}</span>
              <span *ngIf="contact.label" class="contact-label">{{ contact.label }}</span>
            </div>
            <div class="badge-list">
              <span class="badge" [class.badge-primary]="contact.isPrimary" [class.badge-secondary]="!contact.isPrimary">
                {{ contact.isPrimary ? 'PRIMARY' : 'SECONDARY' }}
              </span>
              <span class="badge badge-success" *ngIf="contact.isVerified">VERIFIED</span>
            </div>
          </div>
        </div>
        <div class="contact-actions">
          <div class="context-menu-wrapper">
            <button class="btn-context-menu" 
                    (click)="toggleContextMenu($event, i)" 
                    title="More actions">
              ‚ãÆ
            </button>
            <div class="context-menu" *ngIf="activeContextMenuIndex === i">
              <button class="context-menu-item" (click)="onEdit(contact, $event)">
                <span class="menu-icon">‚úèÔ∏è</span>
                <span>Edit Contact</span>
              </button>
              <button class="context-menu-item context-menu-item-danger" (click)="onDelete(contact, $event)">
                <span class="menu-icon">üóëÔ∏è</span>
                <span>Remove Contact</span>
              </button>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

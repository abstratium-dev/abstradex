<div class="container">
  <div class="page-header">
    <h1>Relationship Type Management</h1>
    <div class="header-actions">
      <button class="btn-add" (click)="toggleAddForm()" [disabled]="formSubmitting">
        {{ showForm ? 'Cancel' : '+ Add Relationship Type' }}
      </button>
    </div>
  </div>

  <!-- Search -->
  <div class="filter-section">
    <div class="filter-input-wrapper">
      <input
        type="text"
        [(ngModel)]="searchTerm"
        (ngModelChange)="onSearchChange()"
        placeholder="Search relationship types..."
        class="filter-input"
      />
      <button *ngIf="searchTerm" class="filter-clear-button" (click)="clearSearch()" title="Clear search">‚úï</button>
    </div>
  </div>

  <!-- Add/Edit Form -->
  <div class="form-container" *ngIf="showForm">
    <h3>{{ editingType ? 'Edit Relationship Type' : 'Add New Relationship Type' }}</h3>
    
    <div class="form-group">
      <label for="typeName">Type Name *</label>
      <input 
        type="text" 
        id="typeName" 
        [(ngModel)]="typeForm.typeName" 
        placeholder="e.g., PARENT_COMPANY, SUBSIDIARY"
        required
        autofocus
      />
    </div>

    <div class="form-group">
      <label for="colorHex">Color</label>
      <div class="color-picker-group">
        <input 
          type="color" 
          id="colorHex" 
          [(ngModel)]="typeForm.colorHex"
          class="color-input"
        />
        <input 
          type="text" 
          [(ngModel)]="typeForm.colorHex" 
          placeholder="#4285f4"
          class="color-text-input"
          pattern="^#[0-9A-Fa-f]{6}$"
        />
        <div class="color-preview" [style.background-color]="typeForm.colorHex"></div>
      </div>
    </div>

    <div class="form-group">
      <label for="description">Description</label>
      <textarea 
        id="description" 
        [(ngModel)]="typeForm.description" 
        placeholder="Optional description of this relationship type"
        rows="3"
      ></textarea>
    </div>

    <div class="form-group">
      <label>
        <input type="checkbox" [(ngModel)]="typeForm.isActive" />
        Active
      </label>
    </div>

    <div *ngIf="formError" class="error-message">{{ formError }}</div>

    <div class="form-actions">
      <button class="btn-primary" (click)="onSubmit()" [disabled]="formSubmitting">
        {{ editingType ? 'Update Type' : 'Add Type' }}
      </button>
      <button class="btn-secondary" (click)="cancelForm()" [disabled]="formSubmitting">Cancel</button>
    </div>
  </div>

  <!-- Loading State -->
  <div *ngIf="loading" class="loading"><p>Loading relationship types...</p></div>

  <!-- Error State -->
  <div *ngIf="error" class="error-box">
    <p>{{ error }}</p>
    <button class="btn-primary" (click)="loadRelationshipTypes()">Retry</button>
  </div>

  <!-- Relationship Types List -->
  <div *ngIf="!loading && !error">
    <h3>Relationship Types ({{ relationshipTypes.length }})</h3>
    
    <div *ngIf="relationshipTypes.length === 0" class="info-message">
      <p>No relationship types found.</p>
      <p>Click "Add Relationship Type" to create a new type.</p>
    </div>

    <div class="tag-grid">
      <div *ngFor="let type of relationshipTypes; let i = index" class="tag-card" (click)="closeContextMenu(i)">
        <div class="tag-header">
          <span class="tag-badge" [ngStyle]="getTypeStyle(type)">{{ type.typeName }}</span>
          <span class="tag-color">{{ type.colorHex }}</span>
          <span *ngIf="!type.isActive" class="badge badge-inactive">Inactive</span>
          <div class="context-menu-wrapper">
            <button class="btn-context-menu" 
                    (click)="toggleContextMenu($event, i)" 
                    title="More actions">
              ‚ãÆ
            </button>
            <div class="context-menu" *ngIf="activeContextMenuIndex === i">
              <button class="context-menu-item" (click)="onEdit(type, $event)">
                <span class="menu-icon">‚úèÔ∏è</span>
                <span>Edit Type</span>
              </button>
              <button class="context-menu-item context-menu-item-danger" (click)="onDelete(type, $event)">
                <span class="menu-icon">üóëÔ∏è</span>
                <span>Delete Type</span>
              </button>
            </div>
          </div>
        </div>
        <div class="tag-description" *ngIf="type.description">
          {{ type.description }}
        </div>
      </div>
    </div>
  </div>
</div>
